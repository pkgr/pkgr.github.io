<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Customizing the build</title>
  <meta name="description" content="Everything you need to know about the .pkgr.yml file">

  <link rel="stylesheet" href="/static/css/main.css">
  <!--[if lte IE 8]>
    <link rel="stylesheet" href="/static/css/pure/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="/static/css/pure/grids-responsive-min.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Raleway:200,400">
  <link rel="canonical" href="https://packager.io/documentation/customizing-the-build/">
  <script src="/static/js/zepto.min.js"></script>
  <script>jQuery = $;</script>
</head>


  <body class="pure-skin-pkgr">

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-13023229-12', 'auto');
      ga('send', 'pageview');

    </script>

    <div id="menu">
  <div class="container">
    <div class="pure-menu pure-menu-open pure-menu-horizontal">
      <a href="/" class="pure-menu-heading"><img alt="Packager" class="logo" src="/static/img/packager.svg"></a>
      <ul>
        <li><a href="/pricing">Pricing</a></li>
        <li><a href="http://blog.packager.io">Blog</a></li>
        <li><a href="/documentation">Documentation</a></li>
      </ul>
    </div>
  </div>
</div>


    <div id="main">
      <div class="container">
  <div class="pure-g">
    <div class="pure-u-1 l-box pure-u-md-1-4">
      <div id="sidebar">
  <div class="pure-menu pure-menu-open">
  
    <a class="pure-menu-heading">getting-started</a>
    <ul>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li class="">
        <a href="/documentation/register/">Register with your GitHub account</a>
      </li>
    
    
    
      <li class="">
        <a href="/documentation/enable-application-for-packaging/">Enable application for packaging</a>
      </li>
    
    
    
    
    
    
    
    
    
      <li class="">
        <a href="/documentation/launch-build/">Launch your first build</a>
      </li>
    
    
    
    
    
      <li class="">
        <a href="/documentation/install-configure-run-package/">Install, configure, and run your packaged application</a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    </ul>
  
    <a class="pure-menu-heading">reference</a>
    <ul>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li class="pure-menu-selected">
        <a href="/documentation/customizing-the-build/">Customizing the build</a>
      </li>
    
    
    
    
    
    
    
      <li class="">
        <a href="/documentation/procfile/">Process types (Procfile)</a>
      </li>
    
    
    
    
    
      <li class="">
        <a href="/documentation/distributions/">Supported distributions</a>
      </li>
    
    
    
    
    
    
    
    
    
      <li class="">
        <a href="/documentation/releases-and-versions/">Releases & Versions</a>
      </li>
    
    
    
      <li class="">
        <a href="/documentation/buildpacks/">Buildpacks</a>
      </li>
    
    
    
      <li class="">
        <a href="/documentation/environment-variables/">Environment variables</a>
      </li>
    
    
    
      <li class="">
        <a href="/documentation/cli/">CLI</a>
      </li>
    
    
    
      <li class="">
        <a href="/documentation/webhooks/">Webhooks</a>
      </li>
    
    
    </ul>
  
    <a class="pure-menu-heading">languages</a>
    <ul>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li class="">
        <a href="/documentation/ruby/">Ruby</a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
      <li class="">
        <a href="/documentation/nodejs/">NodeJS</a>
      </li>
    
    
    
    
    
    
    
      <li class="">
        <a href="/documentation/golang/">Go</a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    </ul>
  
    <a class="pure-menu-heading">tips</a>
    <ul>
    
    
    
      <li class="">
        <a href="/documentation/apt-https/">APT & HTTPS</a>
      </li>
    
    
    
    
    
      <li class="">
        <a href="/documentation/proxy/">How to expose the app to the world</a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    </ul>
  
    <a class="pure-menu-heading">Support</a>
    <ul>
      <li><a href="https://twitter.com/hellopkgr" href="_blank">Tweet at @hellopkgr</a></li>
      <li><a href="mailto:support@packager.io">support@packager.io</a></li>
    </ul>
  </div>
</div>

    </div>
    <div class="pure-u-1 l-box pure-u-md-3-4">
      <div class="header">
        <h1>Customizing the build</h1>
        
        <h2>Everything you need to know about the .pkgr.yml file</h2>
        
      </div>
      <div class="content"> 
        

<div class="intro">

<p>To customize the way your package is built, you can add a <code>.pkgr.yml</code> file at the root of your project repository. This file will be parsed by Packager when a build is run.</p>

</div>

<p>You'll find all the available options explained below.</p>

<h2>
<a id="targets" class="anchor" href="#targets" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>targets</code>
</h2>

<p>Use this option to specify which distributions to target. Each target accepts a YAML hash of options, which will overwrite any other option defined for all distributions.</p>

<div class="alert tip">

<p>The available distributions can be found in <a href="../distributions/">Supported distributions</a>.</p>

<p>By default, packages will be built for <code>ubuntu-14.04</code>, <code>centos-6</code>, and <code>debian-7</code>.</p>

</div>

<p>Use the distribution name as a key to the <code>targets</code> hash, as follows:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">dependencies</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">default-dependency-1</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">default-dependency-2</span>
<span class="l-Scalar-Plain">targets</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">ubuntu-12.04</span><span class="p-Indicator">:</span>
    <span class="c1"># overwrite dependencies only for ubuntu-12.04</span>
    <span class="l-Scalar-Plain">dependencies</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">other-dependency-1</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">other-dependency-2</span>
  <span class="l-Scalar-Plain">ubuntu-14.04</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">debian-7</span><span class="p-Indicator">:</span>
</pre></div>

<p>If you just want to enable a target without any additional option, you can do as follows:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">targets</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">ubuntu-14.04</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">centos-6</span><span class="p-Indicator">:</span>
</pre></div>

<h2>
<a id="buildpack" class="anchor" href="#buildpack" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>buildpack</code>
</h2>

<p>If you want to pass a custom <a href="../buildpacks/">buildpack</a> to package your application, you can do so with the <code>buildpack</code> configuration option. Though we can not ensure that the resulting package will work. Please do contact us if you run into any issue.</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">buildpack</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">https://github.com/heroku/some-buildpack#branch</span>
</pre></div>

<h2>
<a id="build_dependencies" class="anchor" href="#build_dependencies" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>build_dependencies</code>
</h2>

<p>In some cases, some of your app dependencies (e.g. gems with C extensions in the case of Ruby projects) may only be installed if specific development headers are available. To allow for the packaging process to succeed, you must list them with the <code>build_dependencies</code> option. This must be specified as a YAML array.</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">build_dependencies</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">libicu-dev</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">libmagickcore-dev</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">libmagickwand-dev</span>
</pre></div>

<h2>
<a id="crons" class="anchor" href="#crons" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>crons</code>
</h2>

<p>Native packages allow you to easily set up cron jobs, to periodically run tasks for your application.</p>

<p>Let's say you need to run the <code>rake crons:task1</code> every hour, here is what you need to do:</p>

<ol>
<li>
<p>Create a cron job definition in your repository, for instance in <code>packaging/crons/my-app-task1</code>:</p>

<div class="highlight highlight-bash"><pre><span class="c"># cat packaging/crons/my-app-task1</span>
<span class="m">0</span> * * * * my-app my-app run rake crons:task1 1&gt;<span class="p">&amp;</span><span class="m">2</span> &gt;&gt; /var/log/my-app/cron-task1.log
</pre></div>

<p>This cron task wll run as the <code>my-app</code> user (automatically created with your app), and will run the rake task in the context of your application using the <a href="../cli/">cli</a>.</p>

<p>Note: You could replace the first <code>my-app</code> with <code>root</code> if you need to run cron jobs as the <code>root</code> user.</p>
</li>
<li>
<p>Declare your cron in the <code>.pkgr.yml</code> file:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">crons</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">packaging/crons/my-app-task1</span>
</pre></div>
</li>
</ol>

<p>Now, upon installing your package, your cron task will automatically be installed in <code>/etc/cron.d/my-app-task1</code>!</p>

<h2>
<a id="default_dependencies" class="anchor" href="#default_dependencies" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>default_dependencies</code>
</h2>

<p>Every package ships with default dependencies for each supported distribution<br>
(<a href="https://github.com/crohr/pkgr/blob/master/data/dependencies/debian.yml">example</a>).<br>
If you don't want them to be added to your packages (e.g. it does not make<br>
sense for Go applications), you can disable them as follows:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">default_dependencies</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</pre></div>

<h2>
<a id="dependencies" class="anchor" href="#dependencies" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>dependencies</code>
</h2>

<p>If your application requires additional system dependencies to be installed, you can add them with the <code>dependencies</code> configuration option.</p>

<p>This must be specified as a YAML array. For instance:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">dependencies</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="s">"libicu44</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">libicu42"</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">libpcre3</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">git-core</span>
</pre></div>

<h2>
<a id="user" class="anchor" href="#user" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>user</code>
</h2>

<p>The name of the user under which your app processes will be run. If this user does not exist on the target machine, then it will be automatically created. Defaults to your application <code>name</code> (taken from Github, which can be overwritten in the app settings).</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span> <span class="s">"custom-user-name"</span>
</pre></div>

<h2>
<a id="group" class="anchor" href="#group" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>group</code>
</h2>

<p>The name of the group under which your app processes will be run. If this group does not exist on the target machine, then it will be automatically created. Defaults to <code>user</code>.</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">group</span><span class="p-Indicator">:</span> <span class="s">"custom-group-name"</span>
</pre></div>

<h2>
<a id="before_precompile" class="anchor" href="#before_precompile" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>before_precompile</code>
</h2>

<div class="alert warning">

<p>This option is deprecated. You should use the <code>before</code> option.</p>

</div>

<p>In the case of complex apps, you might need to do a bit of housekeeping before the packaging process can start. This can include creating files or folders that should be present for running the app (but not necessarily checked into the repository). In that case, you can add a bash script anywhere in your repository that does just that, and reference it with the <code>before_precompile</code> configuration option:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">before_precompile</span><span class="p-Indicator">:</span> <span class="s">"packaging/debian/setup.sh"</span>
</pre></div>

<h2>
<a id="after_precompile" class="anchor" href="#after_precompile" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>after_precompile</code>
</h2>

<div class="alert warning">

<p>This option is deprecated. You should use the <code>after</code> option.</p>

</div>

<p>If you need to run a task after the buildpack compilation step is finished, you can provide a path to a file to execute:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">after_precompile</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">path/to/file.sh</span>
</pre></div>

<h2>
<a id="before" class="anchor" href="#before" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>before</code>
</h2>

<p>Replacement for <code>before_precompile</code>, which instead of pointing to a file, must be an array of commands to execute before the packaging process starts. e.g.:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">before</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">mv some/file to/path</span>
</pre></div>

<p>Note that <code>before_precompile</code> takes precedence over <code>before</code> if both are specified.</p>

<h2>
<a id="after" class="anchor" href="#after" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>after</code>
</h2>

<p>Replacement for <code>after_precompile</code>, which instead of pointing to a file, must be an array of commands to execute after the buildpack compilation step is finished.</p>

<p>Note that <code>after_precompile</code> takes precedence over <code>after</code> if both are specified.</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">after</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">cp some/file target</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">rm -rf some/dir</span>
</pre></div>

<h2>
<a id="before_install" class="anchor" href="#before_install" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>before_install</code>
</h2>

<p>If you need to execute things just before the package is installed or updated on the user's machine, you can specify a <code>before_install</code> option, the value being the path to a file in your repository (it must have a shebang, e.g. <code>#!/usr/bin/env bash</code>):</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">before_install</span><span class="p-Indicator">:</span> <span class="s">"packaging/debian/preinstall.sh"</span>
</pre></div>

<p>The file will be called with the arguments given to preinstall files for the distribution where the package is being installed. For debian-based distributions, please refer to <a href="https://www.debian.org/doc/debian-policy/ch-maintainerscripts.html">https://www.debian.org/doc/debian-policy/ch-maintainerscripts.html</a>.</p>

<h2>
<a id="after_install" class="anchor" href="#after_install" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>after_install</code>
</h2>

<p>As with <code>before_install</code>, you can specify that a file be executed just after the package has been installed or updated on the user's machine:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">after_install</span><span class="p-Indicator">:</span> <span class="s">"packaging/debian/postinstall.sh"</span>
</pre></div>

<p>The file will be called with the arguments given to postinstall files for the distribution where the package is being installed. For debian-based distributions, please refer to <a href="https://www.debian.org/doc/debian-policy/ch-maintainerscripts.html">https://www.debian.org/doc/debian-policy/ch-maintainerscripts.html</a>.</p>

<h2>
<a id="cli" class="anchor" href="#cli" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>cli</code>
</h2>

<p>By default, all packages come with a <a href="../cli/">command-line utility</a> to manage your application. In some cases it may not be needed, for instance if the application you're packaging is itself a command-line utility with its own executable.</p>

<p>If you don't want the built-in CLI to interfere, you can delegate all calls to your own executable by specifying:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">cli</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">bin/my-cli</span>
</pre></div>

<p>If you don't want any CLI to be installed at all, then put:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">cli</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</pre></div>

<h2>
<a id="env" class="anchor" href="#env" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>env</code>
</h2>

<p>You can set environment variables for use during the packaging process. To do so, use the <code>env</code> configuration option:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">env</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">HELLO=world</span>
</pre></div>

<h2>
<a id="notifications" class="anchor" href="#notifications" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>notifications</code>
</h2>

<p>Whenever a build fails or is successful on a branch, the default is to send an email notification to the authors and committers of the relevant commits (but only those who have also an account on Packager.io).</p>

<p>If you wish to disable all email notifications, add the following to your .pkgr.yml file:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">notifications</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</pre></div>

<p>If you wish to notify a specific set of people, add them to the list of recipients. Only them will receive notifications:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">notifications</span>
  <span class="l-Scalar-Plain">recipients</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">one@example.com</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">other@example.com</span>
</pre></div>

<h2>
<a id="runner" class="anchor" href="#runner" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>runner</code>
</h2>

<p>By default, Debian 7 packages come with sysv init scripts (the ones in <code>/etc/init.d/</code>), because that distribution does not support upstart scripts by default. If you wish to force the use of upstart scripts, then you can set the <code>runner</code> configuration variable to <code>upstart-1.5</code> in your <code>.pkgr.yml</code> file:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">targets</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">debian-7</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">runner</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">upstart-1.5</span>
</pre></div>

<p>On the contrary, upstart scripts are generated by default for Ubuntu 12.04, Ubuntu 14.04, and CentOS 6.x packages, but you can change this to use classic sysv init scripts by doing the following:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">targets</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">ubuntu-12.04</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">runner</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sysv-lsb-3.1</span>
</pre></div>

<p>Note that sysvinit scripts do not support the respawning of crashed processes.</p>

<h2>
<a id="services" class="anchor" href="#services" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>services</code>
</h2>

<p>Sometimes third-party software is required for the packaging of your app to be successful. For instance, some Rails apps require a database to be present when precompiling assets, or even an instance of redis. If you need to have such services started automatically for you before the packaging process starts, you can easily specify them:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">postgres</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">redis</span>
</pre></div>

<p>They will be made available on their default port and address, and will automatically be shut down when your build finishes.</p>

<p>Currently, you can specify the following services (please contact us if you need anything specific):</p>

<ul>
<li>PostgreSQL</li>
<li>Redis</li>
</ul>


      </div>
    </div>
  </div>
</div>

<script src="/static/js/jquery.toc.js"></script>
<script>
  $('#main .content').toc({
      showAlways: false
  });

  var headers = $(".content h2, .content h3");
  headers.on("mouseover", function(e) {
    $(this).find("a.anchor .octicon-link").show();
  }).on("mouseout", function(e) {
    $(this).find("a.anchor .octicon-link").hide();
  });
</script>


    </div>

    

  </body>

</html>
